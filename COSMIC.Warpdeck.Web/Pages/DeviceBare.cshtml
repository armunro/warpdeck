@page "/deviceBare/{deviceId}"
@model COSMIC.Warpdeck.Web.Pages.DeviceBare

@{
    Layout = null;
}
<link href="/vendor/boostrap-5.1.3/css/bootstrap.min.css" rel="stylesheet"/>
<script src="/vendor/boostrap-5.1.3/js/popper.min.js" crossorigin="anonymous"></script>
<script src="/vendor/boostrap-5.1.3/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<link href="/css/layout.css" rel="stylesheet">
<link href="/css/pages.css" rel="stylesheet">
<script src="/js/Partials/KeyGrid.js"></script>
<script src="/js/Pages/Device.js"></script>


<div class="container-fluid" id="keymapGrid">
</div>


<script>
document.addEventListener("DOMContentLoaded", function(event) { 
    function key_pressed(key) {
        let  keyData = key.parentNode.dataset

        fetch(`/api/trigger/${keyData.deviceid}/${keyData.keyid}/press`, {method: "POST"}).then(
            (response) => {console.log(response.json())}
        );
        
    }
    function key_held(key) {
        let  keyData = key.parentNode.dataset
        fetch(`/api/trigger/${keyData.deviceid}/${keyData.keyid}/hold`, {method: "POST"}).then(
             (response) => {console.log(response.json())}
         );
    }
    
    window.keyGrid = new KeyGrid("keymapGrid","@(Model.CurrentDevice.DeviceId)","active", {disableSelection: true}, 1, 5);
    window.keyGrid.registerKeyClickCallback(key_pressed);
    window.keyGrid.registerKeyHoldCallback(key_held);
    window.devicePage = new Device("@(Model.CurrentDevice.DeviceId)")
});
</script>